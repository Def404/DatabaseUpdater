# DatabaseUpdater

DatabaseUpdater — это консольное приложение, предназначенное для обновления нескольких баз данных с помощью SQL-скриптов. Оно поддерживает чтение данных о подключении к базе данных и SQL-скриптов из файлов, а также предоставляет интерфейс командной строки для выполнения SQL-команд.

## Возможности

- Чтение данных о подключении к базе данных из файла JSON.
- Чтение SQL-скриптов из файла или их ввод вручную.
- Выполнение SQL-команд на нескольких базах данных.
- Логирование информации и ошибок в консоль.

## Требования

- .NET 8.0
- Npgsql
- Microsoft.Extensions.Logging

## Использование

### Аргументы командной строки

- `-h`: Показать справочную информацию.
- `-d [путь]`: Указать путь к файлу с данными подключения к базе данных.
- `-s [путь]`: Указать путь к файлу с SQL-скриптом.

### Примеры

1. **Без аргументов**: Программа запросит путь к файлу с базой данных и позволит вводить SQL-команды вручную.

```shell
dotnet run
```

2. **С файлом базы данных**: Укажите путь к файлу базы данных, и программа позволит вводить SQL-команды вручную.

```shell
dotnet run -d путь/к/databaseFile.json
```

3. **С файлом SQL-скрипта**: Укажите путь к файлу SQL-скрипта, и программа запросит файл базы данных.

```shell
dotnet run -s путь/к/sqlScript.sql
```

4. **С файлами базы данных и SQL-скрипта**: Укажите пути к файлу базы данных и файлу SQL-скрипта.

```shell
dotnet run -d путь/к/databaseFile.json -s путь/к/sqlScript.sql
```

### Справка

Чтобы показать справочную информацию, используйте аргумент `-h`:

```shell
dotnet run -h
```

## Запрещённые SQL-команды
Приложение проверяет наличие запрещённых SQL-команд в предоставленном SQL-запросе. Следующие команды запрещены:

- `CREATE DATABASE`
- `DROP DATABASE`
- `CREATE ROLE`
- `ALTER ROLE`
- `DROP ROLE`
- `ALTER SYSTEM`
- `CREATE EXTENSION`
- `DROP EXTENSION`
- `GRANT`
- `REVOKE`
- `DROP TABLE`
- `DROP SCHEMA`
- `TRUNCATE`

Если в SQL-запросе будут обнаружены какие-либо из этих команд, приложение зафиксирует ошибку и не выполнит запрос.

## Логирование

Приложение логирует информацию и ошибки в консоль. Основные лог-сообщения включают:

- Запросы ввода от пользователя.
- Ошибки, связанные с путями к файлам и их содержимым.
- Сообщения об успехе и ошибках при обновлении базы данных.

## Пример файла базы данных

Файл базы данных должен быть в формате JSON и содержать массив объектов базы данных. Каждый объект должен иметь следующие свойства:

```json
[
  {
    "Name": "Test1",
    "ConnectionString": "Host=localhost;Username=login;Password=pass;Database=test1",
    "NeedChange": true
  },
  {
    "Name": "Test2",
    "ConnectionString": "Host=localhost;Username=login;Password=pass;Database=test2",
    "NeedChange": true
  }
]
```

## Пример файла SQL-скрипта

Файл SQL-скрипта должен содержать допустимые SQL-команды. Например:

```sql
CREATE TABLE example ( id SERIAL PRIMARY KEY, name VARCHAR(100) NOT NULL );
INSERT INTO example (name) VALUES ('Sample Name')
```
